{"version":3,"sources":["webpack:///./resources/assets/js/expenses/expenses.js"],"names":["$","document","ready","on","focus","select2","width","datetimepicker","DatetimepickerDefaults","format","useCurrent","sideBySide","tableName","DataTable","processing","serverSide","ajax","url","expenseUrl","data","expense_head","find","val","columnDefs","targets","defaultContent","columns","row","isEmpty","invoice_number","name","id","expenseHeadArray","render","date","moment","amount","getCurrentCurrencyClass","addCommas","document_url","downloadDocumentUrl","prepareTemplateRender","change","reload","event","preventDefault","attr","loginButton","jQuery","this","button","expenseCreateUrl","newRecord","currentTarget","deleteItem","ajaxCallIsRunning","ajaxCallInProgress","expenseId","renderData","window","type","success","result","ext","split","pop","toLowerCase","pdfDocumentImageUrl","docxDocumentImageUrl","defaultDocumentImageUrl","trigger","description","text","html","modal","ajaxCallCompleted","error","manageAjaxErrors","loadingButton","editRecord","resetModalForm","extension","isValidDocument","hide","displayDocument","inputSelector","validationMessageSelector","inArray","documentError","show"],"mappings":"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","file":"/assets/js/expenses/expenses.js","sourcesContent":["$(document).ready(function () {\n    'use strict';\n\n    $('#addModal, #EditModal').on('shown.bs.modal', function () {\n        $('#expenseId, #editExpenseHeadId:first').focus();\n    });\n\n    $('#expenseId, #editExpenseHeadId,#expenseHead').select2({\n        width: '100%',\n    });\n\n    $('#date, #editDate').datetimepicker(DatetimepickerDefaults({\n        format: 'YYYY-MM-DD',\n        useCurrent: true,\n        sideBySide: true,\n    }));\n\n    let tableName = '#expensesTable';\n    let tbl = $(tableName).DataTable({\n        processing: true,\n        serverSide: true,\n        'order': [[3, 'desc']],\n        ajax: {\n            url: expenseUrl,\n            data: function (data) {\n                data.expense_head = $('#expenseHead').\n                    find('option:selected').\n                    val();\n            },\n        },\n        columnDefs: [\n            {\n                'targets': [0],\n                'className': 'text-center',\n                'width': '12%',\n            },\n            {\n                'targets': [4],\n                'className': 'text-right',\n                'width': '10%',\n            },\n            {\n                'targets': [0, 3],\n                'width': '12%',\n            },\n            {\n                'targets': [2],\n                'width': '22%',\n            },\n            {\n                targets: '_all',\n                defaultContent: 'N/A',\n            },\n            {\n                'targets': [5, 6],\n                'orderable': false,\n                'className': 'text-center',\n                'width': '8%',\n            },\n        ],\n        columns: [\n            {\n                data: function (row) {\n                    return isEmpty(row.invoice_number)\n                        ? 'N/A'\n                        : row.invoice_number;\n                },\n                name: 'invoice_number',\n            },\n            {\n                data: function (row) {\n                    let showLink = expenseUrl + '/' + row.id;\n                    return '<a href=\"' + showLink + '\">' + row.name + '</a>';\n                },\n                name: 'name',\n            },\n            {\n                data: function (row) {\n                    return expenseHeadArray[row.expense_head];\n                },\n                name: 'expense_head',\n            },\n            {\n                data: function (row) {\n                    return row;\n                },\n                render: function (row) {\n                    if (row.date === null) {\n                        return 'N/A';\n                    }\n                    return moment(row.date).format('Do MMM, Y');\n                },\n                name: 'date',\n            },\n            {\n                data: function (row) {\n                    return !isEmpty(row.amount)\n                        ? '<p class=\"cur-margin\">' +\n                        getCurrentCurrencyClass() + ' ' +\n                        addCommas(row.amount) + '</p>'\n                        : 'N/A';\n                },\n                name: 'amount',\n            },\n            {\n                data: function (row) {\n                    if (row.document_url != '') {\n                        let downloadLink = downloadDocumentUrl + '/' + row.id;\n                        return '<a href=\"' + downloadLink + '\">' + 'Download' +\n                            '</a>';\n                    } else {\n                        return 'N/A';\n                    }\n                },\n                name: 'id',\n            },\n            {\n                data: function (row) {\n                    let data = [{ 'id': row.id }];\n                    return prepareTemplateRender('#expenseTemplate', data);\n                },\n                name: 'id',\n            },\n        ],\n        'fnInitComplete': function () {\n            $('#expenseHead').change(function () {\n                $(tableName).DataTable().ajax.reload(null, true);\n            });\n        },\n    });\n\n    $(document).on('submit', '#addNewForm', function (event) {\n        event.preventDefault();\n        $('#btnSave').attr('disabled', true);\n        var loginButton = jQuery(this).find('#btnSave');\n        loginButton.button('loading');\n        let data = {\n            'formSelector': $(this),\n            'url': expenseCreateUrl,\n            'type': 'POST',\n            'tableSelector': tableName,\n        };\n        newRecord(data, loginButton, '#addModal');\n    });\n\n    $(document).on('click', '.delete-btn', function (event) {\n        let id = $(event.currentTarget).data('id');\n        deleteItem(expenseUrl + '/' + id, tableName, 'Expense');\n    });\n\n    $(document).on('click', '.edit-btn', function (event) {\n        if (ajaxCallIsRunning) {\n            return;\n        }\n        ajaxCallInProgress();\n        let expenseId = $(event.currentTarget).data('id');\n        renderData(expenseId);\n    });\n\n    window.renderData = function (id) {\n        $.ajax({\n            url: expenseUrl + '/' + id + '/edit',\n            type: 'GET',\n            success: function (result) {\n                if (result.success) {\n                    let ext = result.data.document_url.split('.').\n                        pop().\n                        toLowerCase();\n                    if (ext == 'pdf') {\n                        $('#editPreviewImage').attr('src', pdfDocumentImageUrl);\n                    } else if ((ext == 'docx') || (ext == 'doc')) {\n                        $('#editPreviewImage').\n                            attr('src', docxDocumentImageUrl);\n                    } else if (ext == '') {\n                        $('#editPreviewImage').\n                            attr('src', defaultDocumentImageUrl);\n                    } else {\n                        $('#editPreviewImage').\n                            attr('src', result.data.document_url);\n                    }\n\n                    $('#editExpenseId').val(result.data.id);\n                    $('#editExpenseHeadId').\n                        val(result.data.expense_head).\n                        trigger('change.select2');\n                    $('#editName').val(result.data.name);\n                    $('#editDate').val(format(result.data.date, 'YYYY-MM-DD'));\n                    $('#editInvoiceNumber').val(result.data.invoice_number);\n                    $('#editAmount').val(result.data.amount);\n                    $('.price-input').trigger('input');\n                    $('#editDescription').val(result.data.description);\n                    if (isEmpty(result.data.document_url)) {\n                        $('#documentUrl').text('');\n                    } else {\n                        $('#documentUrl').html('View');\n                        $('#documentUrl').\n                            attr('href', result.data.document_url);\n                    }\n                    $('#EditModal').modal('show');\n                    ajaxCallCompleted();\n                }\n            },\n            error: function (result) {\n                manageAjaxErrors(result);\n            },\n        });\n    };\n\n    $(document).on('submit', '#editForm', function (event) {\n        event.preventDefault();\n        $('#btnSave').attr('disabled', true);\n        let loadingButton = jQuery(this).find('#btnEditSave');\n        loadingButton.button('loading');\n        let id = $('#editExpenseId').val();\n        let url = expenseUrl + '/' + id + '/update';\n        let data = {\n            'formSelector': $(this),\n            'url': url,\n            'type': 'POST',\n            'tableSelector': tableName,\n        };\n        editRecord(data, loadingButton);\n    });\n\n    $('#addModal').on('hidden.bs.modal', function () {\n        resetModalForm('#addNewForm', '#validationErrorsBox');\n        $('#expenseId').val('').trigger('change.select2');\n        $('#previewImage').attr('src', defaultDocumentImageUrl);\n    });\n\n    $('#EditModal').on('hidden.bs.modal', function () {\n        resetModalForm('#editForm', '#editValidationErrorsBox');\n    });\n\n    $(document).on('change', '#attachment', function () {\n        let extension = isValidDocument($(this), '#validationErrorsBox');\n        if (!isEmpty(extension) && extension != false) {\n            $('#validationErrorsBox').html('').hide();\n            displayDocument(this, '#previewImage', extension);\n        }\n    });\n\n    $(document).on('change', '#editAttachment', function () {\n        let extension = isValidDocument($(this), '#editValidationErrorsBox');\n        if (!isEmpty(extension) && extension != false) {\n            $('#editValidationErrorsBox').html('').hide();\n            displayDocument(this, '#editPreviewImage', extension);\n        }\n    });\n\n    window.isValidDocument = function (\n        inputSelector, validationMessageSelector) {\n        let ext = $(inputSelector).val().split('.').pop().toLowerCase();\n        if ($.inArray(ext, ['png', 'jpg', 'jpeg', 'pdf', 'doc', 'docx']) ==\n            -1) {\n            $(inputSelector).val('');\n            $(validationMessageSelector).\n                html(documentError).show();\n            return false;\n        }\n        return ext;\n    };\n});\n"],"sourceRoot":""}