{"version":3,"sources":["webpack:///./resources/assets/js/ipd_prescriptions/ipd_prescriptions.js"],"names":["$","document","ready","tableName","DataTable","processing","serverSide","ajax","url","ipdPrescriptionUrl","data","id","ipdPatientDepartmentId","columnDefs","targets","defaultContent","columns","row","patient","ipd_number","name","render","created_at","moment","format","prepareTemplateRender","on","event","currentTarget","deleteItem","dropdownToSelect2","selector","select2","placeholder","width","itemSelector","parseInt","this","tbodyItemSelector","ipdPrescriptionItemHtml","append","uniqueId","resetIpdPrescriptionItemIndex","itemMode","itemNo","index","each","find","text","parents","remove","e","rData","medicineId","val","medicinesListUrl","type","dataType","success","length","empty","removeAttr","i","v","attr","trigger","prop","preventDefault","loadingButton","jQuery","button","ipdPrescriptionCreateUrl","newRecord","ajaxCallIsRunning","ajaxCallInProgress","ipdPrescriptionId","renderPrescriptionData","window","result","ipdPrescriptionData","ipdPrescription","ipdPrescriptionItemsData","ipdPrescriptionItems","header_note","footer_note","rowId","category_id","medicine_id","dosage","instruction","modal","ajaxCallCompleted","error","manageAjaxErrors","editRecord","beforeSend","screenLock","html","complete","screenUnLock","divToPrint","getElementById","newWin","open","write","bootstarpUrl","innerHTML","close","setTimeout","resetModalForm"],"mappings":"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","file":"/assets/js/ipd_prescriptions/ipd_prescriptions.js","sourcesContent":["$(document).ready(function () {\n    'use strict';\n\n    let tableName = '#tblIpdPrescription';\n    $(tableName).DataTable({\n        processing: true,\n        serverSide: true,\n        'order': [[0, 'desc']],\n        ajax: {\n            url: ipdPrescriptionUrl,\n            data: function (data) {\n                data.id = ipdPatientDepartmentId;\n            },\n        },\n        columnDefs: [\n            {\n                'targets': [2],\n                'className': 'text-center',\n                'orderable': false,\n                'width': '8%',\n            },\n            {\n                targets: '_all',\n                defaultContent: 'N/A',\n            },\n        ],\n        columns: [\n            {\n                data: function (row) {\n                    return '<a href=\"javascript:void(0)\" class=\"viewIpdPrescription\" data-pres-id=\"' +\n                        row.id + '\">' +\n                        row.patient.ipd_number +\n                        '</a>';\n                },\n                name: 'patient.ipd_number',\n            },\n            {\n                data: function (row) {\n                    return row;\n                },\n                render: function (row) {\n                    if (row.created_at === null) {\n                        return 'N/A';\n                    }\n\n                    return moment(row.created_at).format('Do MMM, Y');\n                },\n                name: 'created_at',\n            },\n            {\n                data: function (row) {\n                    let data = [{ 'id': row.id }];\n                    return prepareTemplateRender(\n                        '#ipdPrescriptionActionTemplate',\n                        data);\n                }, name: 'id',\n            },\n        ],\n    });\n\n    $(document).on('click', '.delete-prescription-btn', function (event) {\n        let id = $(event.currentTarget).data('id');\n        deleteItem(ipdPrescriptionUrl + '/' + id, tableName,\n            'IPD Prescription');\n    });\n\n    const dropdownToSelect2 = (selector) => {\n        $(selector).select2({\n            placeholder: 'Select Category',\n            width: '100%',\n        });\n    };\n\n    dropdownToSelect2('.categoryId');\n\n    const medicineSelect2 = (selector) => {\n        $(selector).select2({\n            width: '100%',\n        });\n    };\n\n    $(document).\n        on('click', '#addPrescriptionItem, #addPrescriptionItemOnEdit',\n            function () {\n                const itemSelector = (parseInt($(this).data('edit')))\n                    ? '#editIpdPrescriptionItemTemplate'\n                    : '#ipdPrescriptionItemTemplate';\n                const tbodyItemSelector = (parseInt($(this).data('edit')))\n                    ? '.edit-ipd-prescription-item-container'\n                    : '.ipd-prescription-item-container';\n                let data = {\n                    'medicineCategories': medicineCategories,\n                    'uniqueId': uniqueId,\n                };\n                let ipdPrescriptionItemHtml = prepareTemplateRender(\n                    itemSelector, data);\n                $(tbodyItemSelector).append(ipdPrescriptionItemHtml);\n                dropdownToSelect2('.categoryId');\n                uniqueId++;\n\n                resetIpdPrescriptionItemIndex(parseInt($(this).data('edit')));\n            });\n\n    const resetIpdPrescriptionItemIndex = (itemMode) => {\n        const itemSelector = (itemMode)\n            ? '#editIpdPrescriptionItemTemplate'\n            : '#ipdPrescriptionItemTemplate';\n        const tbodyItemSelector = (itemMode)\n            ? '.edit-ipd-prescription-item-container'\n            : '.ipd-prescription-item-container';\n        const itemNo = (itemMode)\n            ? '.edit-prescription-item-number'\n            : '.prescription-item-number';\n\n        let index = 1;\n        $(tbodyItemSelector + '>tr').each(function () {\n            $(this).find(itemNo).text(index);\n            index++;\n        });\n        if (index - 1 == 0) {\n            let data = {\n                'medicineCategories': medicineCategories,\n                'uniqueId': uniqueId,\n            };\n            let ipdPrescriptionItemHtml = prepareTemplateRender(\n                itemSelector, data);\n            $(tbodyItemSelector).append(ipdPrescriptionItemHtml);\n            dropdownToSelect2('.categoryId');\n            uniqueId++;\n        }\n    };\n\n    $(document).\n        on('click', '.deleteIpdPrescription, .deleteIpdPrescriptionOnEdit',\n            function () {\n                $(this).parents('tr').remove();\n                resetIpdPrescriptionItemIndex(parseInt($(this).data('edit')));\n            });\n\n    $(document).on('change', '.categoryId', function (e, rData) {\n        const medicineId = $(document).\n            find('[data-medicine-id=\\'' + $(this).data('id') + '\\']');\n        if ($(this).val() !== '') {\n            $.ajax({\n                url: medicinesListUrl,\n                type: 'get',\n                dataType: 'json',\n                data: { id: $(this).val() },\n                success: function (data) {\n                    if (data.data.length !== 0) {\n                        medicineId.empty();\n                        medicineId.removeAttr('disabled');\n                        medicineSelect2('.medicineId');\n                        $.each(data.data, function (i, v) {\n                            medicineId.\n                                append($('<option></option>').\n                                    attr('value', i).\n                                    text(v));\n                        });\n\n                        if (typeof rData != 'undefined') {\n                            medicineId.val(rData.medicineId).\n                                trigger('change.select2');\n                        }\n                    } else {\n                        medicineId.prop('disabled', true);\n                    }\n                },\n            });\n        }\n        medicineId.empty();\n        medicineId.prop('disabled', true);\n    });\n\n    $(document).on('submit', '#addIpdPrescriptionForm', function (event) {\n        event.preventDefault();\n        let loadingButton = jQuery(this).find('#btnIpdPrescriptionSave');\n        loadingButton.button('loading');\n        let data = {\n            'formSelector': $(this),\n            'url': ipdPrescriptionCreateUrl,\n            'type': 'POST',\n            'tableSelector': tableName,\n        };\n        newRecord(data, loadingButton, '#addIpdPrescriptionModal');\n    });\n\n    $(document).on('click', '.edit-prescription-btn', function (event) {\n        if (ajaxCallIsRunning) {\n            return;\n        }\n        ajaxCallInProgress();\n        let ipdPrescriptionId = $(event.currentTarget).data('id');\n        renderPrescriptionData(ipdPrescriptionId);\n    });\n\n    window.renderPrescriptionData = function (id) {\n        $.ajax({\n            url: ipdPrescriptionUrl + '/' + id + '/edit',\n            type: 'GET',\n            success: function (result) {\n                if (result.success) {\n                    let ipdPrescriptionData = result.data.ipdPrescription;\n                    let ipdPrescriptionItemsData = result.data.ipdPrescriptionItems;\n                    $('#ipdEditPrescriptionId').val(ipdPrescriptionData.id);\n                    $('#editHeaderNote').val(ipdPrescriptionData.header_note);\n                    $('#editFooterNote').val(ipdPrescriptionData.footer_note);\n\n                    $.each(ipdPrescriptionItemsData, function (i, v) {\n                        $('#addPrescriptionItemOnEdit').trigger('click');\n                        let rowId = uniqueId - 1;\n                        $(document).\n                            find('[data-id=\\'' + rowId + '\\']').\n                            val(v.category_id).\n                            trigger('change', [{ medicineId: v.medicine_id }]);\n                        $(document).\n                            find('[data-dosage-id=\\'' + rowId + '\\']').\n                            val(v.dosage);\n                        $(document).\n                            find('[data-instruction-id=\\'' + rowId + '\\']').\n                            val(v.instruction);\n                    });\n\n                    let index = 1;\n                    $('.edit-ipd-prescription-item-container>tr').\n                        each(function () {\n                            $(this).\n                                find('.prescription-item-number').\n                                text(index);\n                            index++;\n                        });\n\n                    $('#editIpdPrescriptionModal').modal('show');\n                    ajaxCallCompleted();\n                }\n            },\n            error: function (result) {\n                manageAjaxErrors(result);\n            },\n        });\n    };\n\n    $(document).on('submit', '#editIpdPrescriptionForm', function (event) {\n        event.preventDefault();\n        let loadingButton = jQuery(this).find('#btnEditIpdPrescriptionSave');\n        loadingButton.button('loading');\n        let id = $('#ipdEditPrescriptionId').val();\n        let url = ipdPrescriptionUrl + '/' + id;\n        let data = {\n            'formSelector': $(this),\n            'url': url,\n            'type': 'POST',\n            'tableSelector': tableName,\n        };\n        editRecord(data, loadingButton, '#editIpdPrescriptionModal');\n    });\n\n    $(document).on('click', '.viewIpdPrescription', function () {\n        $.ajax({\n            url: ipdPrescriptionUrl + '/' + $(this).data('pres-id'),\n            type: 'get',\n            beforeSend: function () {\n                screenLock();\n            },\n            success: function (result) {\n                $('#ipdPrescriptionViewData').html(result);\n                $('#showIpdPrescriptionModal').modal('show');\n                ajaxCallCompleted();\n            },\n            complete: function () {\n                screenUnLock();\n            },\n        });\n    });\n\n    $(document).on('click', '.printPrescription', function () {\n        let divToPrint = document.getElementById('DivIdToPrint');\n        let newWin = window.open('', 'Print-Window');\n        newWin.document.open();\n        newWin.document.write(\n            '<html><link href=\"' + bootstarpUrl +\n            '\" rel=\"stylesheet\" type=\"text/css\"/>' +\n            '<body onload=\"window.print()\">' + divToPrint.innerHTML +\n            '</body></html>');\n        newWin.document.close();\n        setTimeout(function () {newWin.close();}, 10);\n    });\n\n    $('#addIpdPrescriptionModal').on('hidden.bs.modal', function () {\n        resetModalForm('#addIpdPrescriptionForm', '#validationErrorsBox');\n        $('#ipdPrescriptionTbl').find('tr:gt(1)').remove();\n        $('.categoryId').val('');\n        $('.categoryId').trigger('change');\n    });\n\n    $('#editIpdPrescriptionModal').on('hidden.bs.modal', function () {\n        $('#editIpdPrescriptionTbl').find('tr:gt(0)').remove();\n    });\n\n});\n"],"sourceRoot":""}