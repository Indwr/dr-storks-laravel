{"version":3,"sources":["webpack:///./resources/assets/js/incomes/incomes.js"],"names":["$","document","ready","on","focus","select2","width","datetimepicker","DatetimepickerDefaults","format","useCurrent","sideBySide","tableName","tbl","DataTable","processing","serverSide","ajax","url","incomeUrl","data","income_head","find","val","columnDefs","targets","defaultContent","columns","row","isEmpty","invoice_number","name","id","incomeHeadArray","render","date","moment","amount","getCurrentCurrencyClass","addCommas","document_url","downloadDocumentUrl","prepareTemplateRender","change","reload","event","preventDefault","attr","loginButton","jQuery","this","button","incomeCreateUrl","type","FormData","dataType","processData","contentType","success","result","displaySuccessMessage","message","modal","error","printErrorMessage","complete","currentTarget","deleteItem","renderData","window","ext","split","pop","toLowerCase","pdfDocumentImageUrl","docxDocumentImageUrl","defaultDocumentImageUrl","trigger","description","text","html","manageAjaxErrors","loadingButton","editRecord","resetModalForm","extension","isValidDocument","hide","displayDocument","inputSelector","validationMessageSelector","inArray","documentError","show"],"mappings":"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","file":"/assets/js/incomes/incomes.js","sourcesContent":["$(document).ready(function () {\n    'use strict';\n\n    $('#addModal, #EditModal').on('shown.bs.modal', function () {\n        $('#incomeId, #editIncomeHeadId:first').focus();\n    });\n\n    $('#incomeId,#editIncomeHeadId,#incomeHead').select2({\n        width: '100%',\n    });\n\n    $('#date, #editDate').datetimepicker(DatetimepickerDefaults({\n        format: 'YYYY-MM-DD',\n        useCurrent: true,\n        sideBySide: true,\n    }));\n\n    let tableName = '#incomeTable';\n    let tbl = $(tableName).DataTable({\n        processing: true,\n        serverSide: true,\n        'order': [[3, 'desc']],\n        ajax: {\n            url: incomeUrl,\n            data: function (data) {\n                data.income_head = $('#incomeHead').\n                    find('option:selected').\n                    val();\n            },\n        },\n        columnDefs: [\n            {\n                'targets': [0],\n                'className': 'text-center',\n                'width': '12%',\n            },\n            {\n                'targets': [4],\n                'className': 'text-right',\n                'width': '10%',\n            },\n            {\n                'targets': [0, 3],\n                'width': '12%',\n            },\n            {\n                'targets': [2],\n                'width': '22%',\n            },\n            {\n                targets: '_all',\n                defaultContent: 'N/A',\n            },\n            {\n                'targets': [5, 6],\n                'orderable': false,\n                'className': 'text-center',\n                'width': '8%',\n            },\n        ],\n        columns: [\n            {\n                data: function (row) {\n                    return isEmpty(row.invoice_number)\n                        ? 'N/A'\n                        : row.invoice_number;\n                },\n                name: 'invoice_number',\n            },\n            {\n                data: function (row) {\n                    let showLink = incomeUrl + '/' + row.id;\n                    return '<a href=\"' + showLink + '\">' + row.name + '</a>';\n                },\n                name: 'name',\n            },\n            {\n                data: function (row) {\n                    return incomeHeadArray[row.income_head];\n                },\n                name: 'income_head',\n            },\n            {\n                data: function (row) {\n                    return row;\n                },\n                render: function (row) {\n                    if (row.date === null) {\n                        return 'N/A';\n                    }\n                    return moment(row.date).format('Do MMM, Y');\n                },\n                name: 'date',\n            },\n            {\n                data: function (row) {\n                    return !isEmpty(row.amount)\n                        ? '<p class=\"cur-margin\">' +\n                        getCurrentCurrencyClass() + ' ' +\n                        addCommas(row.amount) + '</p>'\n                        : 'N/A';\n                },\n                name: 'amount',\n            },\n            {\n                data: function (row) {\n                    if (row.document_url != '') {\n                        let downloadLink = downloadDocumentUrl + '/' + row.id;\n                        return '<a href=\"' + downloadLink + '\">' + 'Download' +\n                            '</a>';\n                    } else {\n                        return 'N/A';\n                    }\n                },\n                name: 'id',\n            },\n            {\n                data: function (row) {\n                    let data = [{ 'id': row.id }];\n                    return prepareTemplateRender('#incomeTemplate', data);\n                },\n                name: 'id',\n            },\n        ],\n        'fnInitComplete': function () {\n            $('#incomeHead').change(function () {\n                $(tableName).DataTable().ajax.reload(null, true);\n            });\n        },\n    });\n\n    $(document).on('submit', '#addNewForm', function (event) {\n        event.preventDefault();\n        $('#btnSave').attr('disabled', true);\n        var loginButton = jQuery(this).find('#btnSave');\n        loginButton.button('loading');\n        $.ajax({\n            url: incomeCreateUrl,\n            type: 'POST',\n            data: new FormData(this),\n            dataType: 'JSON',\n            processData: false,\n            contentType: false,\n            success: function (result) {\n                if (result.success) {\n                    displaySuccessMessage(result.message);\n                    $('#addModal').modal('hide');\n                    tbl.ajax.reload(null, false);\n                }\n            },\n            error: function (result) {\n                printErrorMessage('#validationErrorsBox', result);\n            },\n            complete: function () {\n                loginButton.button('reset');\n            },\n        });\n    });\n\n    $(document).on('click', '.delete-btn', function (event) {\n        let id = $(event.currentTarget).data('id');\n        deleteItem(incomeUrl + '/' + id, tableName, 'Income');\n    });\n\n    $(document).on('click', '.edit-btn', function (event) {\n        let id = $(event.currentTarget).data('id');\n        renderData(id);\n    });\n\n    window.renderData = function (id) {\n        $.ajax({\n            url: incomeUrl + '/' + id + '/edit',\n            type: 'GET',\n            success: function (result) {\n                if (result.success) {\n                    let ext = result.data.document_url.split('.').\n                        pop().\n                        toLowerCase();\n                    if (ext == 'pdf') {\n                        $('#editPreviewImage').attr('src', pdfDocumentImageUrl);\n                    } else if ((ext == 'docx') || (ext == 'doc')) {\n                        $('#editPreviewImage').\n                            attr('src', docxDocumentImageUrl);\n                    } else if (ext == '') {\n                        $('#editPreviewImage').\n                            attr('src', defaultDocumentImageUrl);\n                    } else {\n                        $('#editPreviewImage').\n                            attr('src', result.data.document_url);\n                    }\n\n                    $('#editIncomeId').val(result.data.id);\n                    $('#editIncomeHeadId').\n                        val(result.data.income_head).\n                        trigger('change.select2');\n                    $('#editName').val(result.data.name);\n                    $('#editDate').val(format(result.data.date, 'YYYY-MM-DD'));\n                    $('#editInvoiceNumber').val(result.data.invoice_number);\n                    $('#editAmount').val(result.data.amount);\n                    $('.price-input').trigger('input');\n                    $('#editDescription').val(result.data.description);\n                    if (isEmpty(result.data.document_url)) {\n                        $('#documentUrl').text('');\n                    } else {\n                        $('#documentUrl').html('View');\n                        $('#documentUrl').\n                            attr('href', result.data.document_url);\n                    }\n                    $('#EditModal').modal('show');\n                }\n            },\n            error: function (result) {\n                manageAjaxErrors(result);\n            },\n        });\n    };\n\n    $(document).on('submit', '#editForm', function (event) {\n        event.preventDefault();\n        $('#btnSave').attr('disabled', true);\n        let loadingButton = jQuery(this).find('#btnEditSave');\n        loadingButton.button('loading');\n        let id = $('#editIncomeId').val();\n        let url = incomeUrl + '/' + id + '/update';\n        let data = {\n            'formSelector': $(this),\n            'url': url,\n            'type': 'POST',\n            'tableSelector': tableName,\n        };\n        editRecord(data, loadingButton);\n    });\n\n    $('#addModal').on('hidden.bs.modal', function () {\n        resetModalForm('#addNewForm', '#validationErrorsBox');\n        $('#incomeId').val('').trigger('change.select2');\n        $('#previewImage').attr('src', defaultDocumentImageUrl);\n    });\n\n    $('#EditModal').on('hidden.bs.modal', function () {\n        resetModalForm('#editForm', '#editValidationErrorsBox');\n    });\n\n    $(document).on('change', '#attachment', function () {\n        let extension = isValidDocument($(this), '#validationErrorsBox');\n        if (!isEmpty(extension) && extension != false) {\n            $('#validationErrorsBox').html('').hide();\n            displayDocument(this, '#previewImage', extension);\n        }\n    });\n\n    $(document).on('change', '#editAttachment', function () {\n        let extension = isValidDocument($(this), '#editValidationErrorsBox');\n        if (!isEmpty(extension) && extension != false) {\n            $('#editValidationErrorsBox').html('').hide();\n            displayDocument(this, '#editPreviewImage', extension);\n        }\n    });\n\n    window.isValidDocument = function (\n        inputSelector, validationMessageSelector) {\n        let ext = $(inputSelector).val().split('.').pop().toLowerCase();\n        if ($.inArray(ext, ['png', 'jpg', 'jpeg', 'pdf', 'doc', 'docx']) ==\n            -1) {\n            $(inputSelector).val('');\n            $(validationMessageSelector).\n                html(documentError).show();\n            return false;\n        }\n        return ext;\n    };\n});\n\n\n\n"],"sourceRoot":""}