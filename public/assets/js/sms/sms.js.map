{"version":3,"sources":["webpack:///./resources/assets/js/sms/sms.js"],"names":["$","document","ready","select2","width","tableName","tbl","DataTable","processing","serverSide","ajax","url","smsUrl","columnDefs","targets","defaultContent","columns","data","row","showLink","id","user","full_name","name","isEmpty","region_code","phone_number","prepareTemplateRender","hide","attr","show","keypress","e","tval","val","tlength","length","parseInt","which","charCode","substring","html","on","event","preventDefault","loadingButton","jQuery","this","find","button","is","remove","createSmsUrl","type","serialize","success","result","displaySuccessMessage","message","modal","reload","error","printErrorMessage","complete","currentTarget","deleteItem","resetModalForm","trigger","prop","getUsersListUrl","dataType","empty","removeAttr","each","i","v","append","text"],"mappings":"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","file":"/assets/js/sms/sms.js","sourcesContent":["$(document).ready(function () {\n    'use strict';\n\n    $('#userId, #roleId').select2({\n        width: '100%',\n    });\n\n    let tableName = '#smsTable';\n    let tbl = $(tableName).DataTable({\n        processing: true,\n        serverSide: true,\n        ajax: {\n            url: smsUrl,\n        },\n        columnDefs: [\n            {\n                'targets': [3],\n                'orderable': false,\n                'className': 'text-center',\n                'width': '10%',\n            },\n            {\n                targets: '_all',\n                defaultContent: 'N/A',\n            },\n            {\n                'targets': [4],\n                'visible': false,\n            },\n        ],\n        columns: [\n            {\n                data: function (row) {\n                    let showLink = smsUrl + '/' + row.id;\n                    if (row.user != null) {\n                        return '<a href=\"' + showLink + '\">' +\n                            row.user.full_name + '</a>';\n                    } else {\n                        return 'N/A';\n                    }\n                },\n                name: 'user.first_name',\n            },\n            {\n                data: function (row) {\n                    return isEmpty(row.region_code) ? row.phone_number : '+' +\n                        row.region_code + row.phone_number;\n                },\n                name: 'phone_number',\n            },\n            {\n                data: 'send_by.full_name',\n                name: 'sendBy.first_name',\n            },\n            {\n                data: function (row) {\n                    let data = [{ 'id': row.id }];\n                    return prepareTemplateRender('#smsTemplate',\n                        data);\n                }, name: 'id',\n            },\n            {\n                data: 'send_by.last_name',\n                name: 'sendBy.last_name',\n            },\n        ],\n    });\n\n    $('#messageId').keypress(function (e) {\n        var tval = $('#messageId').val(),\n            tlength = tval.length,\n            set = 160,\n            remain = parseInt(set - tlength);\n        if (remain <= 0 && e.which !== 0 && e.charCode !== 0) {\n            $('#messageId').val((tval).substring(0, tlength - 1));\n            $('#validationErrorsBox').\n                html('The message may not be greater than 160 characters.').\n                show();\n        }\n    });\n\n    $(document).on('submit', '#addNewForm', function (event) {\n        event.preventDefault();\n        var loadingButton = jQuery(this).find('#btnSave');\n        loadingButton.button('loading');\n        if ($('#number').is(':checked')) {\n            $('#roleId').remove();\n            $('#userId').remove();\n        }\n        $.ajax({\n            url: createSmsUrl,\n            type: 'POST',\n            data: $(this).serialize(),\n            success: function (result) {\n                if (result.success) {\n                    displaySuccessMessage(result.message);\n                    $('#AddModal').modal('hide');\n                    tbl.ajax.reload();\n                }\n            },\n            error: function (result) {\n                printErrorMessage('#validationErrorsBox', result);\n            },\n            complete: function () {\n                loadingButton.button('reset');\n            },\n        });\n    });\n\n    $(document).on('click', '.delete-btn', function (event) {\n        let id = $(event.currentTarget).data('id');\n        deleteItem(smsUrl + '/' + id, tableName, 'SMS');\n    });\n\n    $('#AddModal').on('hidden.bs.modal', function () {\n        resetModalForm('#addNewForm', '#validationErrorsBox');\n        $('#userId').val('').trigger('change.select2');\n        $('#roleId').val('').trigger('change.select2');\n        hide();\n    });\n\n    $('.myclass').hide();\n    $('#phoneNumber').prop('required', false);\n    $(document).on('click', '.number', function () {\n        if ($('.number').is(':checked')) {\n            $('.myclass').show();\n            $('.number').attr('value', 1);\n            $('.role').hide();\n            $('#roleId').prop('required', false);\n            $('.send').hide();\n            $('#userId').prop('required', false);\n            $('#phoneNumber').prop('required', true);\n        } else {\n            $('#phoneNumber').prop('required', false);\n            hide();\n        }\n    });\n\n    function hide () {\n        $('.myclass').hide();\n        $('.number').attr('value', 0);\n        $('.role').show();\n        $('.send').show();\n    }\n});\n\n$('#roleId').on('change', function () {\n    if ($(this).val() !== '') {\n        $.ajax({\n            url: getUsersListUrl,\n            type: 'get',\n            dataType: 'json',\n            data: { id: $(this).val() },\n            success: function (data) {\n                $('#userId').empty();\n                $('#userId').removeAttr('disabled');\n                $.each(data.data, function (i, v) {\n                    $('#userId').\n                        append($('<option></option>').attr('value', i).text(v));\n                });\n            },\n        });\n    }\n    $('#userId').empty();\n    $('#userId').prop('disabled', true);\n});\n"],"sourceRoot":""}