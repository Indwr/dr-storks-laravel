{"version":3,"sources":["webpack:///./resources/assets/js/invoices/new.js"],"names":["$","first","blur","document","ready","select2","width","focus","dropdownToSelect2","selector","placeholder","invoiceDateEle","datetimepicker","DatetimepickerDefaults","format","useCurrent","maxDate","moment","val","invoiceDate","window","isNumberKey","evt","element","charCode","which","event","keyCode","indexOf","on","data","invoiceItemHtml","prepareTemplateRender","append","uniqueId","resetInvoiceItemIndex","index","each","this","find","text","parents","remove","calculateAndSetInvoiceAmount","qty","parseInt","rate","parent","siblings","removeCommas","amount","calculateAmount","addCommas","toString","totalAmount","itemTotal","isEmpty","trim","parseFloat","toFixed","calculateDiscount","discount","discountAmount","finalAmount","e","preventDefault","screenLock","formData","FormData","ajax","url","invoiceSaveUrl","type","dataType","processData","contentType","success","result","displaySuccessMessage","message","location","href","invoiceUrl","id","error","printErrorMessage","complete","screenUnLock"],"mappings":"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","file":"/assets/js/invoices/new.js","sourcesContent":["$('input:text:not([readonly=\"readonly\"])').first().blur();\n$(document).ready(() => {\n    'use strict';\n\n    $('#patient_id, #status').select2({\n        width: '100%',\n    });\n\n    $('#patient_id').focus();\n\n    const dropdownToSelect2 = (selector) => {\n        $(selector).select2({\n            placeholder: 'Select Account',\n            width: '100%',\n        });\n    };\n\n    dropdownToSelect2('.accountId');\n\n    let invoiceDateEle = $('#invoice_date');\n    invoiceDateEle.datetimepicker(DatetimepickerDefaults({\n        format: 'YYYY-MM-DD',\n        useCurrent: false,\n        maxDate: moment(),\n    }));\n\n    invoiceDateEle.val(invoiceDate);\n\n    window.isNumberKey = (evt, element) => {\n        let charCode = (evt.which) ? evt.which : event.keyCode;\n\n        return !((charCode !== 46 || $(element).val().indexOf('.') !== -1) &&\n            (charCode < 48 || charCode > 57));\n    };\n\n    $(document).on('click', '#addItem', function () {\n        let data = {\n            'accounts': accounts,\n            'uniqueId': uniqueId,\n        };\n        let invoiceItemHtml = prepareTemplateRender(\n            '#invoiceItemTemplate', data);\n        $('.invoice-item-container').append(invoiceItemHtml);\n        dropdownToSelect2('.accountId');\n        uniqueId++;\n\n        resetInvoiceItemIndex();\n    });\n\n    const resetInvoiceItemIndex = () => {\n        let index = 1;\n        $('.invoice-item-container>tr').each(function () {\n            $(this).find('.item-number').text(index);\n            index++;\n        });\n        if (index - 1 == 0) {\n            let data = {\n                'accounts': accounts,\n                'uniqueId': uniqueId,\n            };\n            let invoiceItemHtml = prepareTemplateRender(\n                '#invoiceItemTemplate', data);\n            $('.invoice-item-container').append(invoiceItemHtml);\n            dropdownToSelect2('.accountId');\n            uniqueId++;\n        }\n    };\n\n    $(document).on('click', '.delete-invoice-item', function () {\n        $(this).parents('tr').remove();\n        resetInvoiceItemIndex();\n        calculateAndSetInvoiceAmount();\n    });\n\n    $(document).on('keyup', '.qty', function () {\n        let qty = parseInt($(this).val());\n        let rate = $(this).parent().siblings().find('.price').val();\n        rate = parseInt(removeCommas(rate));\n        let amount = calculateAmount(qty, rate);\n        $(this).parent().siblings('.amount').text(addCommas(amount.toString()));\n        calculateAndSetInvoiceAmount();\n    });\n\n    $(document).on('keyup', '.price', function () {\n        let rate = $(this).val();\n        rate = parseInt(removeCommas(rate));\n        let qty = parseInt($(this).parent().siblings().find('.qty').val());\n        let amount = calculateAmount(qty, rate);\n        $(this).parent().siblings('.amount').text(addCommas(amount.toString()));\n        calculateAndSetInvoiceAmount();\n    });\n\n    const calculateAmount = (qty, rate) => {\n        if (qty > 0 && rate > 0) {\n            return qty * rate;\n        } else {\n            return 0;\n        }\n    };\n\n    const calculateAndSetInvoiceAmount = () => {\n        let totalAmount = 0;\n        $('.invoice-item-container>tr').each(function () {\n            let itemTotal = $(this).find('.item-total').text();\n            itemTotal = removeCommas(itemTotal);\n            itemTotal = isEmpty($.trim(itemTotal)) ? 0 : parseInt(itemTotal);\n            totalAmount += itemTotal;\n        });\n        totalAmount = parseFloat(totalAmount);\n\n        $('#total').text(addCommas(totalAmount.toFixed(2)));\n\n        //set hidden input value\n        $('#total_amount').val(totalAmount);\n\n        calculateDiscount();\n    };\n\n    const calculateDiscount = () => {\n        let discount = $('#discount').val();\n        let totalAmount = removeCommas($('#total').text());\n\n        if (isEmpty(discount) || isEmpty(totalAmount)) {\n            discount = 0;\n        }\n\n        let discountAmount = (totalAmount * discount / 100);\n        let finalAmount = totalAmount - discountAmount;\n\n        $('#finalAmount').text(addCommas(finalAmount.toFixed(2)));\n        $('#total_amount').val(finalAmount.toFixed(2));\n        $('#discountAmount').text(addCommas(discountAmount.toFixed(2)));\n    };\n\n    $(document).on('keyup', '#discount', function (e) {\n        calculateDiscount();\n    });\n\n    $(document).on('submit', '#invoiceForm', function (event) {\n        event.preventDefault();\n        screenLock();\n        let formData = new FormData($(this)[0]);\n        $.ajax({\n            url: invoiceSaveUrl,\n            type: 'POST',\n            dataType: 'json',\n            data: formData,\n            processData: false,\n            contentType: false,\n            success: function (result) {\n                displaySuccessMessage(result.message);\n                window.location.href = invoiceUrl + '/' + result.data.id;\n            },\n            error: function (result) {\n                printErrorMessage('#validationErrorsBox', result);\n            },\n            complete: function () {\n                screenUnLock();\n            },\n        });\n    });\n});\n"],"sourceRoot":""}