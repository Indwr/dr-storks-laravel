{"version":3,"sources":["webpack:///./resources/assets/js/postals/postal.js"],"names":["$","document","ready","datetimepicker","DatetimepickerDefaults","format","useCurrent","sideBySide","tableName","DataTable","processing","serverSide","ajax","url","postalUrl","columnDefs","targets","defaultContent","columns","data","row","ispostal","to_title","from_title","name","isEmpty","date","document_url","id","prepareTemplateRender","on","event","preventDefault","attr","loadingButton","jQuery","this","find","button","formData","FormData","postalCreateUrl","type","processData","contentType","success","result","displaySuccessMessage","message","modal","reload","setTimeout","error","printErrorMessage","currentTarget","deleteItem","ajaxCallIsRunning","ajaxCallInProgress","postalId","renderData","window","ext","split","pop","toLowerCase","pdfDocumentImageUrl","docxDocumentImageUrl","defaultDocumentImageUrl","hiddenId","val","reference_no","address","text","html","ajaxCallCompleted","manageAjaxErrors","editRecord","resetModalForm","extension","isValidDocument","hide","displayDocument","inputSelector","validationMessageSelector","inArray","documentError","removeClass","removeAttr","addClass"],"mappings":"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","file":"/assets/js/postals/postal.js","sourcesContent":["$(document).ready(function () {\n    'use strict';\n\n    $('#date, #editDate').datetimepicker(DatetimepickerDefaults({\n        format: 'YYYY-MM-DD',\n        useCurrent: true,\n        sideBySide: true,\n    }));\n\n    let tbl = $(tableName).DataTable({\n        processing: true,\n        serverSide: true,\n        'order': [[0, 'asc']],\n        ajax: {\n            url: postalUrl,\n        },\n        columnDefs: [\n            {\n                'targets': [3],\n                'className': 'text-center',\n                'width': '12%',\n            },\n            {\n                targets: '_all',\n                defaultContent: 'N/A',\n            },\n            {\n                'targets': [4, 5],\n                'orderable': false,\n                'className': 'text-center',\n                'width': '8%',\n            },\n        ],\n        columns: [\n            {\n                data: function (row) {\n                    return ispostal == '2' ? row.to_title : row.from_title;\n                },\n                name: ispostal == '2' ? 'to_title' : 'from_title',\n            },\n            {\n                data: 'reference_no',\n                name: 'reference_no',\n            },\n            {\n                data: function (row) {\n                    return ispostal == '2' ? row.from_title : row.to_title;\n                },\n                name: ispostal == '2' ? 'from_title' : 'to_title',\n            },\n            {\n                data: function (row) {\n                    return isEmpty(row.date) ? 'N/A' : row.date;\n                },\n                name: 'date',\n            },\n            {\n                data: function (row) {\n                    if (row.document_url != '') {\n                        let downloadLink = postalUrl + '/' + row.id;\n                        return '<a href=\"' + downloadLink + '\">' + 'Download' +\n                            '</a>';\n                    } else {\n                        return 'N/A';\n                    }\n                },\n                name: 'id',\n            },\n            {\n                data: function (row) {\n                    let data = [{ 'id': row.id }];\n                    return prepareTemplateRender('#postalTemplate', data);\n                },\n                name: 'id',\n            },\n        ],\n    });\n\n    $(document).on('submit', '#addNewForm', function (event) {\n        event.preventDefault();\n        $('#btnSave').attr('disabled', true);\n        let loadingButton = jQuery(this).find('#btnSave');\n        loadingButton.button('loading');\n        let formData = new FormData($(this)[0]);\n        $.ajax({\n            url: postalCreateUrl,\n            type: 'POST',\n            data: formData,\n            processData: false,\n            contentType: false,\n            success: function (result) {\n                if (result.success) {\n                    displaySuccessMessage(result.message);\n                    $('#addModal').modal('hide');\n                    $(tableName).DataTable().ajax.reload(null, false);\n                    setTimeout(function () {\n                        loadingButton.button('reset');\n                    }, 1000);\n                }\n            },\n            error: function (result) {\n                printErrorMessage('#validationErrorsBox', result);\n                setTimeout(function () {\n                    loadingButton.button('reset');\n                }, 1000);\n            },\n        });\n    });\n\n    $(document).on('click', '.delete-btn', function (event) {\n        let id = $(event.currentTarget).data('id');\n        deleteItem(postalUrl + '/' + id, tableName, name);\n    });\n\n    $(document).on('click', '.edit-btn', function (event) {\n        if (ajaxCallIsRunning) {\n            return;\n        }\n        ajaxCallInProgress();\n        let postalId = $(event.currentTarget).data('id');\n        renderData(postalId);\n    });\n\n    window.renderData = function (id) {\n        $.ajax({\n            url: postalUrl + '/' + id + '/edit',\n            type: 'GET',\n            success: function (result) {\n                if (result.success) {\n                    let ext = result.data.document_url.split('.').\n                        pop().\n                        toLowerCase();\n                    if (ext == 'pdf') {\n                        $('#editPreviewImage').attr('src', pdfDocumentImageUrl);\n                    } else if ((ext == 'docx') || (ext == 'doc')) {\n                        $('#editPreviewImage').\n                            attr('src', docxDocumentImageUrl);\n                    } else if (ext == '') {\n                        $('#editPreviewImage').\n                            attr('src', defaultDocumentImageUrl);\n                    } else {\n                        $('#editPreviewImage').\n                            attr('src', result.data.document_url);\n                    }\n\n                    $(hiddenId).val(result.data.id);\n                    $('#editFromTitle').val(result.data.from_title);\n                    $('#editDate').\n                        val(result.data.date ? format(result.data.date,\n                            'YYYY-MM-DD') : '');\n                    $('#editReferenceNumber').val(result.data.reference_no);\n                    $('#editToTitle').val(result.data.to_title);\n                    $('#editAddress').val(result.data.address);\n                    if (isEmpty(result.data.document_url)) {\n                        $('#documentUrl').text('');\n                    } else {\n                        $('#documentUrl').html('View');\n                        $('#documentUrl').\n                            attr('href', result.data.document_url);\n                    }\n                    $('#editModal').modal('show');\n                    ajaxCallCompleted();\n                }\n            },\n            error: function (result) {\n                manageAjaxErrors(result);\n            },\n        });\n    };\n\n    $(document).on('submit', '#editForm', function (event) {\n        event.preventDefault();\n        $('#btnEditSave').attr('disabled', true);\n        let loadingButton = jQuery(this).find('#btnEditSave');\n        loadingButton.button('loading');\n        let id = $(hiddenId).val();\n        let url = postalUrl + '/' + id;\n        let data = {\n            'formSelector': $(this),\n            'url': url,\n            'type': 'post',\n            'tableSelector': tableName,\n        };\n        editRecord(data, loadingButton);\n        $('#editModal').modal('hide');\n    });\n\n    $('#addModal').on('hidden.bs.modal', function () {\n        resetModalForm('#addNewForm', '#validationErrorsBox');\n        $('#previewImage').attr('src', defaultDocumentImageUrl);\n    });\n\n    $('#editModal').on('hidden.bs.modal', function () {\n        resetModalForm('#editForm', '#editValidationErrorsBox1');\n        $('#previewImage').attr('src', defaultDocumentImageUrl);\n    });\n\n    $(document).on('change', '#attachment', function () {\n        let extension = isValidDocument($(this), '#validationErrorsBox');\n        if (!isEmpty(extension) && extension != false) {\n            $('#validationErrorsBox').html('').hide();\n            displayDocument(this, '#previewImage', extension);\n        }\n    });\n\n    $(document).on('change', '#editAttachment', function () {\n        let extension = isValidDocument($(this),\n            '#editModal #editValidationErrorsBox1');\n        if (!isEmpty(extension) && extension != false) {\n            displayDocument(this, '#editPreviewImage', extension);\n        }\n    });\n\n    window.isValidDocument = function (\n        inputSelector, validationMessageSelector) {\n        let ext = $(inputSelector).val().split('.').pop().toLowerCase();\n        if ($.inArray(ext, ['png', 'jpg', 'jpeg', 'pdf', 'doc', 'docx']) ==\n            -1) {\n            $(inputSelector).val('');\n            $(validationMessageSelector).\n                html(documentError).\n                removeClass('display-none');\n            $(validationMessageSelector).removeAttr('style');\n            return false;\n        }\n\n        $(validationMessageSelector).\n            html(documentError).\n            addClass('display-none');\n        return ext;\n    };\n});\n"],"sourceRoot":""}